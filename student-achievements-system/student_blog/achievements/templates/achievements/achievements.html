{% extends 'achievements/base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <!-- Page Header -->
    <div class="text-center" style="margin: 3rem 0;">
        <h1 style="font-size: 3rem; margin-bottom: 1rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            üèÜ Student Achievements
        </h1>
        <p style="font-size: 1.2rem; color: var(--text-light);">
            Celebrating the success stories of our brilliant students
        </p>
    </div>

    <!-- Search Bar -->
    <div class="card" style="margin-bottom: 2rem;">
        <form method="GET" action="{% url 'achievements' %}" style="display: flex; gap: 1rem; align-items: center;">
            <input type="text" 
                   name="search" 
                   value="{{ search_query }}" 
                   placeholder="üîç Search achievements by name, event, or competition..." 
                   class="form-control"
                   style="flex: 1;">
            <button type="submit" class="btn">Search</button>
            {% if search_query %}
            <a href="{% url 'achievements' %}" class="btn btn-secondary">Clear</a>
            {% endif %}
        </form>
    </div>

    <!-- Achievements Grid -->
<div class="achievement-grid">
    {% for achievement in achievements %}
    <div class="achievement-card">
        
        <!-- In dashboard.html, achievements.html, etc. -->
{% if achievement.image %}
    <!-- Try direct URL -->
    <img src="/media/{{ achievement.image }}" alt="{{ achievement.name }}" 
         style="width: 80px; height: 80px; object-fit: cover; border-radius: 10px; border: 2px solid var(--primary-blue);"
         onerror="this.style.display='none';">
{% elif achievement.image_url %}
    <img src="{{ achievement.image_url }}" alt="{{ achievement.name }}" 
         style="width: 80px; height: 80px; object-fit: cover; border-radius: 10px; border: 2px solid var(--primary-blue);">
{% else %}
    <div style="width: 80px; height: 80px; background: var(--gradient-primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white;">
        <i class="fas fa-trophy"></i>
    </div>
{% endif %}
        
        <div class="achievement-content">
            <h3>{{ achievement.name }}</h3>
            <p style="color: var(--text-light); margin-bottom: 1rem;">{{ achievement.description|truncatewords:25|default:"No description available" }}</p>
            
            <div class="achievement-meta">
                <span class="meta-tag">
                    <i class="fas fa-calendar"></i> {{ achievement.event }}
                </span>
                <span class="meta-tag" style="background: #fef3c7; color: #d97706;">
                    <i class="fas fa-award"></i> {{ achievement.prize }}
                </span>
                {% if achievement.competition %}
                <span class="meta-tag" style="background: #ecfdf5; color: #065f46;">
                    <i class="fas fa-flag"></i> {{ achievement.get_competition_display }}
                </span>
                {% endif %}
            </div>
            
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="width: 32px; height: 32px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem;">
                            {{ achievement.student.first_name|first }}{{ achievement.student.last_name|first }}
                        </div>
                        <span style="font-weight: 600;">{{ achievement.student.get_full_name }}</span>
                    </div>
                    <small style="color: var(--text-light);">
                        {{ achievement.date_achieved|date:"M d, Y"|default:"Recent" }}
                    </small>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="card text-center" style="grid-column: 1 / -1; padding: 4rem 2rem;">
        <i class="fas fa-search fa-4x" style="color: var(--text-light); margin-bottom: 2rem;"></i>
        <h3>No Achievements Found</h3>
        <p style="color: var(--text-light); margin-bottom: 2rem;">
            {% if search_query %}
            No achievements match your search "{{ search_query }}". Try different keywords.
            {% else %}
            No achievements have been posted yet. Be the first to showcase your success!
            {% endif %}
        </p>
        {% if user.is_authenticated %}
        <a href="{% url 'dashboard' %}" class="btn">
            <i class="fas fa-plus"></i> Add Your Achievement
        </a>
        {% else %}
        <a href="{% url 'signup' %}" class="btn">Join Our Community</a>
        {% endif %}
    </div>
    {% endfor %}
</div>
    <!-- Load More Button -->
    {% if achievements|length >= 6 %}
    <div class="text-center" style="margin-top: 3rem;">
        <button class="btn btn-secondary" id="loadMore">
            <i class="fas fa-spinner"></i> Load More Achievements
        </button>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const loadMoreBtn = document.getElementById('loadMore');
    if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', function() {
            this.innerHTML = '<div class="loading"></div> Loading...';
            // Simulate loading more achievements
            setTimeout(() => {
                this.innerHTML = '<i class="fas fa-spinner"></i> Load More Achievements';
                showNotification('More achievements loaded successfully!', 'success');
            }, 1500);
        });
    }
});
</script>
{% endblock %}